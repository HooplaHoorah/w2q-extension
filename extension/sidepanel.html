<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Web-to-Quest</title>
    <style>
      :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
      body { margin: 12px; }
      h3 { margin: 16px 0 8px; }
      textarea, input[type="text"] { width: 100%; box-sizing: border-box; padding: 8px; font-size: 14px; }
      textarea { min-height: 70px; }
      button { padding: 8px 10px; font-size: 14px; margin: 6px 6px 6px 0; cursor: pointer; }
      .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
      .out { border: 1px solid #ddd; padding: 8px; border-radius: 6px; min-height: 40px; margin: 6px 0; white-space: pre-wrap; }
      .out[data-expandable] { max-height: 160px; overflow: hidden; transition: max-height .25s ease; }
      .out[data-expanded="true"] { max-height: none; overflow: visible; }
      .linkbtn { border: none; background: none; color: #0b57d0; padding: 0; cursor: pointer; font: inherit; }
      .linkbtn:hover { text-decoration: underline; }
      .muted { color: #666; }

      .mode-toggle { display: flex; gap: 8px; margin: 8px 0 12px; }
      .mode-btn { padding: 6px 10px; border: 1px solid #ddd; border-radius: 8px; background: #fff; }
      .mode-btn[aria-selected="true"] { border-color: #4285f4; box-shadow: 0 0 0 2px rgba(66,133,244,.15); }

      /* Show/Hide sections by mode (wrapping comes in Step 4) */
      .for-general, .for-math { display: none; }
      body[data-mode="general"] .for-general { display: block; }
      body[data-mode="math"]    .for-math    { display: block; }

    </style>
  </head>
  <body>

<!-- Mode toggle -->
<nav class="mode-toggle" role="tablist" aria-label="Mode">
  <button id="mode-general" class="mode-btn" role="tab" aria-selected="true" data-mode="general">
    General
  </button>
  <button id="mode-math" class="mode-btn" role="tab" aria-selected="false" data-mode="math">
    Math
  </button>
</nav>


  <!-- AI status row -->
<div id="aiStatusRow" style="display:flex;gap:12px;align-items:center;margin:.5rem 0;">
  <span id="aiStatus" class="muted">AI: checking…</span>
  <a id="aiHelp" class="muted" href="./help/ai.html" target="_blank">Help → How to enable AI</a>
</div>    </div>

    <div class="info" id="howto" style="border:1px solid #e0e0e0;background:#fafafa;padding:10px;border-radius:8px;margin-bottom:12px;">
      <strong>How to use</strong>
      <ol style="margin:8px 0 0 18px;padding:0;">
        <li>Select a math expression on any page.</li>
        <li>Right‑click → <em>Send selection → Web‑to‑Quest</em> (or paste into <strong>Problem</strong>).</li>
        <li>Click <strong>Generate steps</strong> and/or <strong>Hint me</strong> for guidance.</li>
        <li>Type your answer, then click <strong>Check answer</strong>. The correct result is only shown here.</li>
      </ol>
    
</div>

    <div class="info" id="settings" style="border:1px solid #e0e0e0;background:#f6fbff;padding:10px;border-radius:8px;margin-bottom:12px;">
      <strong>Settings</strong>
      <div style="margin-top:6px; display:flex; align-items:center; gap:10px;">
        <label><input type="checkbox" id="aiToggle"> Enable AI features (Gemini Nano, if available)</label>
        <!-- The AI status is now displayed in its own row; this span is removed. -->
      </div>
    </div>

    <section class="for-math">
<h3>Problem</h3>
    <textarea id="problem" name="problem" placeholder="Select text, then right-click → Send selection → Web-to-Quest."></textarea>
    <div class="row">
      <button data-btn="steps" id="btnSteps">Generate steps</button>
      <button data-btn="hint" id="btnHint">Hint me</button>
      <button data-btn="explain" id="btnExplain" data-ai-only disabled title="Enable AI in Settings">Explain this step (AI)</button>
    </div>

    <h3 id="answer-label">Answer</h3>
    <input id="answer" name="answer" type="text" autocomplete="off" placeholder="Type your answer…" />
    <div>
      <button data-btn="check" id="btnCheck">Check answer</button>
      <button data-btn="variants" id="btnVariants" data-ai-only disabled title="Enable AI in Settings">Generate printable variants (AI)</button>
    </div>

    <h3>Outputs</h3>
    <div class="muted" style="display:flex;justify-content:space-between;align-items:center;gap:8px;">Steps <button class="linkbtn" id="stepsToggle" hidden>Show all</button></div>
    <div class="out" id="outSteps" data-expandable></div>
    <div class="muted">Hints</div>
    <div class="out" id="outHints"></div>
    <div class="muted">Check Answer</div>
    <div class="out" id="outAnswer"></div>

    </section>
<section class="for-general">
    <div class="info">
    <strong>General tools</strong>
    <p class="muted" style="margin:8px 0 0;">
      Paste or send selected text via context menu. Then choose an action.
    </p>
  </div>

  <label for="genInput"><strong>Input</strong></label>
<textarea id="genInput"
          placeholder="Select text, then right-click → Send selection → Web-to-Quest (or paste here)."
          style="min-height:120px;"></textarea>

<div class="row" style="gap:8px;align-items:center;margin:8px 0;">
  <button id="genSummarize" class="out" data-ai-only>Summarize</button>

  <button id="genRewrite" class="out" data-ai-only>Rewrite</button>
  <select id="genTone" title="Rewrite tone" aria-label="Rewrite tone">
    <option value="friendly" selected>Friendly</option>
    <option value="concise">Concise</option>
    <option value="formal">Formal</option>
    <option value="simplify">Simplify</option>
  </select>
</div>

<div class="row" style="gap:8px;align-items:center;margin:8px 0;">
  <button id="genTranslate" class="out" data-ai-only>Translate</button>
  <select id="genLang" title="Target language" aria-label="Target language">
    <option value="en">English</option>
    <option value="es" selected>Spanish</option>
    <option value="fr">French</option>
    <option value="de">German</option>
    <option value="pt">Portuguese</option>
    <option value="it">Italian</option>
    <option value="ja">Japanese</option>
    <option value="ko">Korean</option>
    <option value="zh">Chinese</option>
  </select>
</div>

<div class="row" style="gap:8px;align-items:center;margin:8px 0;">
  <button id="genExtract" class="out" data-ai-only>Extract</button>
  <select id="genExtractType" title="What to extract" aria-label="What to extract">
    <option value="highlights" selected>Highlights</option>
    <option value="key_points">Key points</option>
    <option value="dates">Dates</option>
    <option value="people">People</option>
    <option value="tasks">Tasks / To-dos</option>
  </select>
</div>


  <div class="row" style="gap:8px;align-items:center;margin:8px 0;">
    <button id="genTranslate" class="out">Translate</button>
    <select id="genLang" title="Target language">
      <option value="en">English</option>
      <option value="es" selected>Spanish</option>
      <option value="fr">French</option>
      <option value="de">German</option>
      <option value="pt">Portuguese</option>
      <option value="it">Italian</option>
      <option value="ja">Japanese</option>
      <option value="ko">Korean</option>
      <option value="zh">Chinese</option>
    </select>
  </div>

  <div class="row" style="gap:8px;align-items:center;margin:8px 0;">
    <button id="genExtract" class="out">Extract</button>
    <select id="genExtractType" title="What to extract">
      <option value="highlights" selected>Highlights</option>
      <option value="key_points">Key points</option>
      <option value="dates">Dates</option>
      <option value="people">People</option>
      <option value="tasks">Tasks / To-dos</option>
    </select>
  </div>

  <div class="info">
    <strong>Result</strong>
    <div id="genOut" class="out" style="min-height:140px;"></div>
  </div>

</section>
<script src="prototype.js" defer></script>
    <script src="ai-stubs.js" defer></script>
    <script src="sidepanel.js" defer></script>
  </body>
</html>
